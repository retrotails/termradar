#!/usr/bin/env python3
'''
	termradar, NOAA radar images for your terminal
	Copyright (C) 2021 retrotails

	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU Affero General Public License as
	published by the Free Software Foundation, version 3.

	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU Affero General Public License for more details.

	You should have received a copy of the GNU Affero General Public License
	along with this program.  If not, see <https://www.gnu.org/licenses/>.
'''

from os import get_terminal_size, path, makedirs, remove
from re import split, search
from time import sleep
from math import floor
from PIL import Image
from argparse import ArgumentParser
import numpy as np
from subprocess import run, PIPE
from glob import glob
from configparser import ConfigParser
config = ConfigParser()
def clamp(v,n,x):
	return min(max(v,n),x)

### Start configuration ###

# Map resolution
res_img = [7000, 3500]

# col_actual is the RGB values for your actual terminal colors,
# used to find the closest color for approximation of the image.
# You can put the hex color codes for your terminal theme here,
# if you want the map colors to match better
col_actual = [
	[0x00,0x00,0x00], # black
	[0xaa,0x00,0x00], # red
	[0x00,0xaa,0x00], # green
	[0xaa,0xaa,0x00], # orange
	[0x00,0x00,0xaa], # blue
	[0xaa,0x00,0xaa], # purple
	[0x00,0xaa,0xaa], # cyan
	[0xaa,0xaa,0xaa], # grey
	[0x55,0x55,0x55], # dark grey
	[0xff,0x55,0x55], # light red
	[0x55,0xff,0x55], # light green
	[0xff,0xff,0x55], # yellow
	[0x55,0x55,0xff], # light blue
	[0xff,0x55,0xff], # light purple
	[0x55,0xff,0xff], # light cyan
	[0xff,0xff,0xff], # white
]
col_actual = np.array(col_actual)


### End configuration ###


# Find config directory
from xdg.BaseDirectory import xdg_config_home
if "xdg_config_home" in locals():
	conf_dir = xdg_config_home
else:
	from path import expanduser
	conf_dir = expanduser("~/.config")
conf_dir = path.join(conf_dir, "termradar")
if not path.exists(conf_dir):
	err = makedirs(conf_dir, 0o755, True)
	if (err):
		raise ValueError("Error: \"" + conf_dir + "\" could not be created (" + err +")")

# Do the same, find cache directory
from xdg.BaseDirectory import xdg_cache_home
if "xdg_cache_home" in locals():
	cache_dir = xdg_cache_home
else:
	from path import expanduser
	cache_dir = expanduser("~/.cache")
cache_dir = path.join(cache_dir, "termradar")
if not path.exists(cache_dir):
	err = makedirs(cache_dir, 0o755, True)
	if (err):
		raise ValueError("Error: \"" + cache_dir + "\" could not be created (" + err +")")

# Create default config file
if not path.exists(path.join(conf_dir, "config")):
	with open(path.join(conf_dir, "config"),"a+") as f:
		f.write("[main]\nrect=300,1000,1000,1500\npins=1100,2050;800,1777\n")

# Load config file
try:
	config.read(path.join(conf_dir, "config"))
except:
	print("Could not parse config file, \"" + path.join(conf_dir, "config") + "\", try deleting it.")
	exit(1)

# Check if configuration is valid
rect = []
for i in split(",", config.get("main", "rect")):
	rect.append(int(i))
if not (
	rect[0] > 0 and rect[0] + rect[2] < res_img[0] and
	rect[1] > 0 and rect[1] + rect[3] < res_img[1]
):
	print("Invalid view rectangle ({0})".format(rect))
	print("Can't be negative and must be within map size. ({0} x {1})".format(res_img[0], res_img[1]))
	exit(1)

pins = []
for i in split(";", config.get("main", "pins")):
	p = []
	for s in split(",", i):
		p.append(int(s))
	pins.append(p)
# TODO check if pins are valid


# https://stackoverflow.com/questions/54242194/python-find-the-closest-color-to-a-color-from-giving-list-of-colors/54244301#54244301
def closest(color):
	color = np.array(color)
	distances = np.sqrt(np.sum((col_actual-color)**2,axis=1))
	# now, why I need to get [0][0], I have no idea
	return np.where(distances==np.amin(distances))[0][0]

def is_int(i):
	try:
		int(i)
		return True
	except ValueError:
		return False

parser = ArgumentParser(description="Show NOAA radar images in the commandline")
parser.add_argument("--lowres",
	help="Don't use unicode characters to double resolution",
	action="store_true")
parser.add_argument("--size",
	help="Size (in characters) to render (Default: Fill terminal window)",
	metavar="WxH")
parser.add_argument("--lines",
	help="State outlines. Options: top/above, bottom/below, none (Default: top)")
parser.add_argument("--nopins",
	help="Don't draw blinking pins",
	action="store_true")
parser.add_argument("--anim",
	help="Download older frames and show animation (download and display intensive!)",
	action="store_true")
parser.add_argument("--frames",
	help="Number of frames to animate (1 to 6, Default: 3)")
parser.add_argument("--all",
	help="Show entire contiguous US",
	action="store_true")
parser.add_argument("--update",
	help="Download new images (Entire US radar is cached, only run this when data is stale!)",
	action="store_true")

args = parser.parse_args()

# Terminal control characters for the various colors
col_fg = [
	"\033[1;30m","\033[1;31m","\033[1;32m","\033[1;33m",
	"\033[1;34m","\033[1;35m","\033[1;36m","\033[1;37m",
	"\033[1;90m","\033[1;91m","\033[1;92m","\033[1;93m",
	"\033[1;94m","\033[1;95m","\033[1;96m","\033[1;97m",
]
col_bg = [
	"\033[0;40m","\033[0;41m","\033[0;42m","\033[0;43m",
	"\033[0;44m","\033[0;45m","\033[0;46m","\033[0;47m",
	"\033[0;100m","\033[0;101m","\033[0;102m","\033[0;103m",
	"\033[0;104m","\033[0;105m","\033[0;106m","\033[0;107m",
]

res = [0,0]
res_scale = 0
offset = [0,0]
canvas = []

res_term = [get_terminal_size().columns, get_terminal_size().lines]

# Check terminal size
if args.size:
	s = split('x',args.size)
	if (is_int(s[0]) and is_int(s[1])):
		res_term = [int(s[0]), int(s[1]) ]
	else:
		print("Error: Invalid size")
		exit(1)
if args.all:
	rect = [0, 0, res_img[0], res_img[1]]
res_term[1] = res_term[1] * 2
if (res_term[0] < 16 or res_term[1] < 16):
	print("Terminal window too small (<16x16)")
	exit(1)

# Hard resolution limit
res_term[0] = min(res_term[0], 512)
res_term[1] = min(res_term[1], 1024)

res_scale = min(res_term[0]/rect[2], res_term[1]/rect[3])
res = [
	floor(res_scale*rect[2]),
	floor(res_scale*rect[3])
]

# Scrape TIF images from NOAA using some lazy commands
def get_map(frames, location):
	base_url = "https://mrms.ncep.noaa.gov/data/RIDGEII/L2/CONUS/CREF_RAW/"
	def get_tif(url):
		tif = run(["wget", "-O", "-", "-o", "/dev/null", base_url + url + ".tif.gz"], check=True, capture_output=True)
		out = run(["gunzip", "-c"], input=tif.stdout, capture_output=True)
		return out.stdout
	for f in glob(location + "/" + "*.tif"):
		remove(f)
	# Get latest list of images
	result = run(["wget", "-O", "-", "-o", "/dev/null", base_url], stdout=PIPE)
	files = []
	for line in str(result).split('\\n'):
		if ".tif.gz" in line:
			files.append(search('<a href="(.*).tif.gz">', line).group(1))
	# Download and save to file
	i = 0
	for f in range(frames):
		print("Downloading frame " + str(f))
		fil = open(path.join(location, str(i) + ".tif"), "wb")
		fil.write(get_tif(files[-(i*4 + 1)]))
		fil.close()
		i += 1

def set_pixel(x,y,c):
	global canvas
	if x >= 0 and x < res[0] and y >= 0 and y < res[1]:
		canvas[y*res[0] + x] = c

def draw_line(x0, y0, x1, y1):
	x0 = floor((x0-rect[0])*res_scale)
	y0 = floor((y0-rect[1])*res_scale)
	x1 = floor((x1-rect[0])*res_scale)
	y1 = floor((y1-rect[1])*res_scale)
	set_pixel(x1, y1, 0xf)

	steep = abs(y1 - y0) > abs(x1 - x0)

	if steep:
		x0, y0 = y0, x0
		x1, y1 = y1, x1
	if x0 > x1:
		x0, x1 = x1, x0
		y0, y1 = y1, y0

	dx = x1 - x0
	dy = abs(y1 - y0)
	error = dx / 2
	y = y0

	if y0 < y1: ystep = 1 
	else: ystep = -1

	for x in range(x0, x1):
		if steep: set_pixel(floor(y), floor(x), 0xf)
		else: set_pixel(floor(x), floor(y), 0xf)
		error -= dy
		if error < 0:
			y += ystep
			error += dx

def draw_outline():
	for j in range(0, len(lines_x),2):
		draw_line(lines_x[j]*5,lines_y[j]*5,lines_x[j+1]*5,lines_y[j+1]*5)

def get_radar(index):
	cref = Image.open(path.join(cache_dir, str(index) + ".tif"))
	#=cref.convert("RGBA")
	# Use PIL to crop and resize radar image to fit terminal
	out = cref.resize(
		(res[0], res[1]),
		box=(rect[0],rect[1],rect[0]+rect[2],rect[1]+rect[3]),
		resample=0
	)
	# debug
	# out.save("resize-output.png")
	w,h = out.size
	px = out.load()
	for y in range(0,h):
		for x in range(0,w):
			r,g,b,a = px[x,y]
			if a > 0:
				set_pixel(x,y,closest([r,g,b]))

def get_str(index):
	global canvas
	canvas = [0] * (res[0]*res[1])
	if args.lines:
		if args.lines == "top" or args.lines == "above":
			get_radar(index)
			draw_outline()
		elif args.lines == "bottom" or args.lines == "below":
			draw_outline()
			get_radar(index)
		else:
			get_radar(index)
			
	else:
		get_radar(index)
		draw_outline()
	if not args.nopins:
		for p in pins:
			set_pixel(
				floor((p[0] - rect[0])*res_scale),
				floor((p[1] - rect[1])*res_scale),
				"blink"
			)

	string = ""
	for y in range(0, res[1]-2, 2):
		string += "\n"
		for x in range(res[0]):
			pixel1 = canvas[ y   *res[0] + x]
			pixel2 = canvas[(y+1)*res[0] + x]
			if (pixel1 == "blink" or pixel2 == "blink"):
				string += col_bg[0]
				string += "\033[93;5m"
				string += chr(0x2588)
				string += col_bg[0]
			else:
				if args.lowres:
					if pixel2 == 15:
						# fix holes in lines
						string += col_fg[15]
					else:
						string += col_fg[pixel1]
					string += chr(0x2588)
				else:
					string += col_bg[pixel2]
					string += col_fg[pixel1]
					string += chr(0x2580)
		string += "\033[0;30m"
	return string

def main():
	if args.update:
		frames = 1
		if args.anim:
			frames = 3
		if args.frames:
			frames = clamp(int(args.frames), 1, 6)
		get_map(frames, cache_dir)
	elif len(glob(cache_dir + "/*.tif")) == 0:
		print("Error: No images, please use --update")
		exit()

	if args.anim:
		anim = []
		# For each tif file in cache_dir
		for i in range(len(glob(cache_dir + "/*.tif"))-1, -1, -1):
			print("Generating frame " + str(i))
			anim.append(get_str(i))
		while True:
			for i in anim:
				print(i)
				sleep(0.5)
			sleep(1.5)
	else:
		print(get_str(0))

# https://github.com/amit1rrr/numcompress/
def decompress(text):
	result = []
	index = 0
	last_num = 0
	while index < len(text):
		index, diff = decompress_number(text, index)
		last_num += diff
		result.append(last_num)
	return result
def decompress_number(text, index):
	result = 1
	shift = 0
	while True:
		b = ord(text[index]) - 63 - 1
		index += 1
		result += b << shift
		shift += 5
		if b < 0x1f:
			break
	return index, (~result >> 1) if (result & 1) != 0 else (result >> 1)

# Map outlines, encoded to save space
lines_x = decompress(
"oG`@???C?C?H???K?N?@?L?B?@?_@?k@?G?D???L?C?G?F?@?G?E?E?E?F???E?B?D???@?H?C?C?E?G?E?@?G?L?C?F?D?eF?kE?gE?}D?qD?eB???M?C?I?G?A?O?A?K?A?Q?M?B?I?C?C?I?E?M?Y?C?[?C"
"?M?r@?n@?O?U?M?A?F?G?M?O?I?S?E?G?A?G?C?E?@?K?B?G?O?K?O?K?Y?U?S?@?e@?D?M?^?@?^?B?X?N?C?F?F?@?V?N?C?Q?G?J?C?H?A?H?E?@?E?G?M?K?M?I?B?H?E?@?I?@?G???A?C?C?I?B?E?@?"
"G???I?I?H???G?G?I?G?E?I?Q???E?D?@?E???H???J?B?M?C?I?M?G?I?A?B?D?B?D?H?@?H?M?E?C?A?A?C?L?C?K?E?O?K?Q?_@?i@?S?E?B?A?F???c@?Q?E?G?O???A?G?K?E?A?B?A?G?J?W?@?e@?eC"
"?E?G?G?C???G?@?M?@?G?B???A???A?E?A?]?G???E?Y?Q???M?A?B?A???C?E?E?D?A?E?A?J?B?@?D???H?F?H?H?H?@?D???B?J?D?J?F?H?C?F???N?@?A?E?J?B?A?C?I?B?E?A?I?I???A?A?R?H???L"
"?F?B?B?A?B?A???B?J?J?\\?@?F?B?P?D?B???A?B?@?C?D?@?D?A?I?@?B?@?D?B?A?B?A?D?@?A?F?F?A?A?D?D?F?D???@?E?K?J?F?A???E???C???E?C???B?@?E???@?A?B?@?D?R?C?D???D?H?A?G?"
"H???E?@?@?B?A?C?A?B?K?@?A?D?A?F?B?@?D?E?D?G?H?@?A?G?C?P?H?H?G?J?M?]?@?^?a@???D?A?D?J?M?G?B?J?T?S?I?E???M?A?B?I?F???F?C?T?D?A?Y???C?E?C?@?D?F?N?B?A?P?U???H?E?F"
"?J?K?K?E?F?T?H?B?A?L?D?@?@?@?J?H?N?F?B?C?F?D?B???F?B?A?R?H?G?F?@???D?A?C?D?A?D?C?D?B???D?B?A?B?D?C???B?C?C?G?S?D?A?D?E?M?M?B?D?B?A?B?D?D?D?H?@?A?E?A?F?F?N?B??"
"?D?G?H?@?A?@?C???F?B?E?D?H?@?B???K?@?@???@?@?B?@?C???H?C?@?G???@?A???B?@?H?N?A?F?B?N?P?G?d@?L?E?L?C?X?K?P?B?L???F?B?D?A?H?F?D?D?H?`@?N?V?F?K?O???I?E?L?I?O?B?X"
"?@?N?G?D?H?J?R?D?J?T?G?H?b@?X?@?E?@?D???A?H?L?@?H?C?@?D?D?C?F???`@?H?F?A?J?I?H?D?A?D?D?D?G?D?D?H?G?E?F?B?B?B???K?@?B???C?A???G?@?B?J?T?D?H?F?H?F?D???B?C?F?H?F"
"?F?L?@?\\?Z?D?D?H?P?r@?J?C?F?@?V?P?J?D?D?`A???pB?tC?A?|A?@?D???A?D?T?J?@?D?A?D?H?P?@?J?D?L?L?@?D?A?@?A?@???H?A?B?B?B?D?@?B?@?B?J?@?C?A?D?D?J???B???C???K?J?E?]"
"?\\?F?@?R?A?C?P?P?A?D?C?J?J?@?E?A?C?@?C?B?B?A?F?@?A???D?E???E?@?C?C?B?C?C?B?A?A?@?A?A?A?B?E?B?A?A?B?@?C?B?E?A???C?Sej@G???Q?@?K?T?LRS?E?\\?CcAE?K?PkAA?D?CcAG?"
"E?F?DkRE?F?B?EVECA@?EC~@B?B???C?A?AHI?A?JTK?B?FRA?A?BCC?@?@KG~BB???C?E???I?K?C?S?G?F?C?A?F?B?f@?B?@{@U?H?@?J?A_@A^CBAxBG`@?@AKCJA?C?K?@?R?DrDA?B?AC@?AxIAC?CE?"
"@EKd@G@@e@IAGfDG?E?F?DzBM?IhAOPL?F?H?D???E?CBE?B?@|ZEa@EDC?A?E?Fx@I?E?D?F?@@@?F?C?ELBhBAEE?@?BHE???D??EE?B?@C@?E?BI@?A?A?@EC?A?D?@?@?B?C?A?B?B?C?C?AEF?A?A?@?B"
"?A?A???C?@???@??HA@Cyf@E@EC?|g@I?E?C?Q?O?U?E?}@?W?sAD??E?@?E?I?C?V?H?M?B?AmFnOiD??}B?wAWgE?wG?gH~P???wGfJ???wG??nK??D?N?D?E?A?Q?P???F?A?G?@?Fr@??K?C?c@?O?D?C?"
"D?C?G?I?U???K?I?G?K?C?a@???A?MsDD?oC?A?yB???O?G?G?]?K?I?I?U?E?U?k@?_@?Q???E?A?K?B?B?@nJ?e@??kGzI}E?Q?E?W?E?O?C?G?C?G?A?E?A???C?C?G?E?I?C?E?J?I?A?G???G?@lBC???"
"K?A???G???J?E?G?C??nHiHsErE???A???@???C?A?@?D?C?CmFI?C?g@?K?K?O???K?@?G??nDF???P?D???G?D?I?G?C?E?K?G?M?A???E?B?E?M?A?G???I???B?B?X?@?E?D?@?H???B?@?E?K?A?I?C?E"
"?C?K?H?C?]???A?@???E?C???E?@?A?D?B?B?B?A?B?C?D?A?B?A?B?C?J?A?F?A?H?A?F???B?@?D???F?C?F???D?C?B?C?@?C?B?C?B?C?B?I?D???H?B?B?A?B?@?A?B?mA?B?C?EpDqBhCqD?C???J?Yp"
"FqB?o@?Ia@oBg@oA???u@dFG?S?C?B?Q?@?A?C?C?@?G?C?A?Q?K?G?I?M?G?C?K?@?Y?@?E?E?C?E?E?G?K?E?K?K?C?G?A?I?A?C?@?G?C?E?@?E?C?E?A?S?G?A?@?E??jH@?C???K?E?D?E??cUAEBGBl@"
"F?BP??B?A?B?L?B?J?@?@?@?Cb@??????A???B?A?@?C?A???mA?E?A?A?E?CR@?P???@fA@?G?@?C?@?IFY???A???g@~H??qD?G?E?G?A?D?H?A?B???C?A?K?N??O_@fG??}D?E?GLA?YnD??O?C?G?C?I?"
"??E?C?G?E?C?@?K?@?C?E?E?C???F?DpE??K?M?C?I?I?E?M?A?O?G?@?I?G?E?E?I?K?C?E?A?I?C?S?ChD\\???D???F?@?V?v@?d@?P?r@?@?F?A?x@`@uA???y@?k@?s@?o@RaA?A?I???_A?aDjIA?G?G"
"?M?Q?C?A?C?G?A?E?G?E?E?C?C???A{Bj@?@?h@?@?B?B?@?t@?Z?F?@?M?E?C?A?E???A?C?G?A?E?C???E?I???C?A?E?C???A?A?C`HA?A?N?Ce@??A?H?A?eBVO?E?C???A?B?@?@?C?B?E?A?A?iB?A?C"
"?A?@?A?C?I?E")
lines_y = decompress(
"_JB?N?M?P?A?D?B???L?V?N?B?I?A?G?I?B?O???@?A?@?F???H?C?A?G???I?B?G?F?I?A?B?A?F?A?T?F?P?D?B?J?????????????N?C?U?C?@?A?A?C???B???C?A?A?G?B?@?G?C?D?C???C???Q?_@?C"
"?F?D?E?K?B?A?B?D???D???B?D?E?C?I?F?G?F?C?K?A?A?H?A?D?K???K?G???G?J?G???M?J???I?J?]?S?E?L?E?K?I?K?G?Q?U?Q?G?M?C?F?L?R?T?P?D?J?J?L?@?D???B?A?H?Q?H?K?L?F?B?@?B?B"
"?D???E?@?G???E?E?E?@?C?E?S?A?G?C?I?G?F?H?B?E?a@?C?Q?D?A?K?A?K?I?C?C???@?A???A?A???A?D?A?H?H?N?L?@?F?B?@?D?D?C?C?B?A?A?B?@?D???F?D?@?@?D?J?B?R???H???B?E?F???D?"
"D?B?B?@?D???B?D?@?J?\\?A?E?C?F?K?u@?C?C?A?C?A?G?@?G?C?A?@?C?E?@?C?@?E?B?I?F?K?B?F?C?E?K?@?G?C?D?G?C?A?E?K?G?G?A?E?E?C?@?G?C?A?E?A?@?D???K???E?H?I?H???B?E???A?"
"E?C?A???C?B?G???E?E???B?F?F?A?K?K???G?A?A?M???M?C?A?A?A?C???A?A?I?A?B?D?????D?D?B?@?D?B?A?E?C?E?G?E?C?A?E???C?A?A???E?A?A?C???I?A?D?@?D?A?H?B?@?B?B?A?B?@?C?F?"
"A?D?@?J???B???E?E?@?E?@?C?M?Q?D?D?I?C?I?F?H?A?H?K?A?Q?I?T?Y?G?B?E???H?M?A?E?H?B?G?I???B?A?G?G?Q?F?C?B?E?C?H?M?@?M?H?B?I?G?B?I?@?@?C?D?I?C???A?E?F?K?D?C?I???C?"
"D?G?G?E?K?J?K?@?A?K?M?B?E?G?@?A?C?C?@?E?G?@?E?E?D?C?H?K?A?C?B?E?A?E?@?C?C?M?C?C?Q???E?@?E?Q?U?_@???B?@?Q?Y?c@?c@?G?G?E?E?@?C?@?C?B?D?E?@?B?P?D?F?J?@?F?G?F?D?@"
"?@?@?A?@?G?@?N?D?@?B?H?D???E?@?D?@?E?A?E?D?H?B?J?H?@???B?B?D?@?L?D?@?F?D?C?C?I?P???H?G?H???D?E???F?A?G?A?F?I???R?Q?B?A?E?F?I?E?D?G?B?I?E?I?G?I?L?F?@?E?K?H?I?F"
"?F?H???E?C?J?C?B?B?D?A?G?E?@?G?B?A?D?B?E?B?O?E?G?M???B?E?D?K?E?D?I?A?@?C???K?B???C?C?M?@?C?F?I???I???G???I?A?O?G?A?F?@?B?@?D?@?N?F?F?B?D?F?D?J?D?X?F?X???B?C??"
"?a@?V?P?F?F?F?N?N?B?H?@???Q???l@?H?G?D???D???N?N?D?A?@?@?F???B?D?D?A?B?A?B???D?@?B?B?H?@?B?D???F???B?B?D???H?J?@?F?D?A?H?F?D?H???E?E?P?D?A?@?B?M?F?D?C?R?N?B?J"
"?H?P?F?D?H?@?J?B?J?L???F?B?J?D?B?H?H?F?B???H?@?A?\\???@?D???@?N?J?@?@???B?B???B?F?@?F?A?C?D?A??j@C?G?N?@?????ETF?D?I?CsBC?P?M`@E???DHB?G???B_AC?E?D?BMA?@B@A?w"
"AB???A?@?E?@Y??C?B?@?B?ED??D?E?@?D?GABe@??@?D???@?B?A?@?@?B?G???A?A???G?B?CHH?C?@?C?CL?A?A?_CJGAH?_@FKESS?Q?Q?E?CkGJ?A?IHI?Gt@@?@BF?FFAEBC@D???Y@?G?@?BSH@Bk@F"
"KE?E?O?M?M?U?KC??D?EdHAGGV??C?A?DXA???A???BC@?A?C?B@?tQ?IA?A?BCC?A?@?B???B?CAC?A?DA??E?@?BUA?@?B?A?F???B???@?E?C?E??BB?B???CW@?B?A?CCC?A?@?A?Dl@ADAkAB@@@@e@??"
"E?M?A?D???C?J?B??vBiB?G?C?G?C?E?c@?Q?A?Q?gA?@AuB?{A?cAlA?????aF`F?~C???`D??|C_If@eF?G?B?E?]?Q?S?M?O?E?M?A?I?AjSe@?K?K?[?A?W?G?E?E?C?H?Y?E?E?M?B?A?B???D?@?K{NF"
"???rD???kA?G?@?G?E?@?K?D?I?F?G?F?K?C?}@?E?I?O?Q?G?S`GR~C_DvB?vB??G?B???C?C?E???M?I?M?E?K?O?E?C?I?I?C?@?I?C?G?E?A?kB?k@?eAdRI?U?U?[?K?K?S?G?G?A?C?gA`B?aB??A?A?"
"C???A???C?C?K?A?E`DC?E?E?E???C?C?C?M???I~@C?U?G?G?C?E?Y?E?A?C?A?I?C?E?Q?C?A?E?Q?C?E?C?C?G?I?A?G?E?G?G?G?E?C?G???K?M?G?C?E?M?A?B?E?U?C?U?C?C?E???G?C?B?C?E?C?E?"
"@?G?B?E?A?C???C?E?C???A?C?G?E?I?E?A?C?C???M???C?E?C?A?G?C?C?A?C?C?G?E?A?G???C?K?G?C?G?I?C?C?C???I?A???K?E?MnB?jC??C?C?K??vD??@?ItAA[??kBfB@}DH?E?B?D?F?D?B???@"
"?B?A?A?D?G?F?E?L?G?J???J?D?@?J?@?A?@?C?G?A?E?@?A?B?E?C?A???D???F?H?E?B?B?F???B?A?J?V?D?F?@?t@gDB?H?B?H?J?L?H?|AzAKJKJI[L?jAMC?E?E?E?C?O?O?S?C?C?CzAE?A?G?E?I?E"
"?K?G?@?A?a@?A?B?@???@??m@J???W?CMD?B?B?\\???XYA????????HK???E?M?A?A?E?I?C?C?G???E?I?G?Cz@MOc@???B??Cq@?Ar@U?J?A?F?C???B???@?C???I???C?C?A?A?C?A?G?A?I@K?Q?E?G?"
"E?D?C?B?B???F?@?J?J?J?C?A?N?A?D???H?H?K?FgAO?C?A?C?A?C?E?@???@?A?@???G??{@???????????`AA?@?A???A??}@H?@?F?B?F???D???B?C?B?B?A?F?@???@?FkBb@???@?B?D?A?B?@?G?G?"
"C?G?A?E?E?E?A???A?E?C?C?C?C?G?C?C?G?E?C?G?E?A???AtBA?A?wB?{@@B?D?D?D??~CqA?M?E?C?A?C?G?E?K?M?G?I???G?E???F?@?D?@?C??"
)
main()